@model Kenmark_Consumer.Models.WhereToBuy

@using System.Web.UI.WebControls

@{
    ViewBag.Title = "Where to Buy";
}
<script type="text/javascript" src="http://maps.googleapis.com/maps/api/js"></script>

<script type="text/javascript">
    var map;
    var bounds;
    var marker;
    
   

    $(function () {
        

        $('#rangeFilter').click(function () {
            
            $.get("/WhereToBuy/GetCustomers", $("#buyFilter").serialize()).done(function (data) {
                
                $('#customerWrapper').hide().html(data.html).fadeIn(250);
                
                buildMap(data.GooglePoints);
                
            });
        });

        $(document).keypress(function (e) {
            if (e.which == 13) {
                $('#rangeFilter').click();
                return false;
            }
        }); // catches Enter press, clicks the filter button
    });

    function buildMap(points) {
        
       
        var customers = JSON.parse(points);

        bounds = new google.maps.LatLngBounds();
        
        $(customers).each(function (index, element) {
           
           marker = new google.maps.Marker({
                position: new google.maps.LatLng(element.latitude, element.longitude),
                map: map,
                title: element.customer_name,
                animation: google.maps.Animation.DROP,
                
            });
           bounds.extend(marker.position);

            
      });// end foreach loop
        
        map.fitBounds(bounds);
        
    }
  
    
       
 
    


   function initialize() {
        var bounds = new google.maps.LatLngBounds();
        var KenmarkLatLng = new google.maps.LatLng(38.210972, -85.536872);
        var mapOptions = {
        zoom: 4,
        center: KenmarkLatLng

     };
       
       map = new google.maps.Map(document.getElementById('map-canvas'), mapOptions);
      
    }

    google.maps.event.addDomListener(window, 'load', initialize);

    google.maps.event.addDomListener(window, 'resize', function () {
        var center = map.getCenter();
        google.maps.event.trigger(map, 'resize');
        map.setCenter(center);
    });

 
   
    
    
   
</script>

<div class="row" style="margin-top: 50px;">
    <div class="col-xs-12 col-sm-3" style="padding-left:50px;">
        <span class="center-block" style="font-size:20px;font-weight:bold;">WHERE TO BUY</span><br />
        <span style="font-size:14px;">Find retail locations where Kenmark Brands are sold.</span>
    

        @using (Html.BeginForm("GetCustomers", "WhereToBuy", FormMethod.Post, new { @id = "buyFilter" }))
        {
           <div class="col-xs-12 no-gutter" style="margin-top:30px;">
               @(Html.LabelFor(m => m.Zip, new { @style="font-size:16px"}))<br />
               @(Html.TextBoxFor(m => m.Zip, new { @class="form-control" }))
           </div>
            
           <div class="col-xs-12 no-gutter" style="margin-top:30px;margin-bottom:30px;">
              @(Html.LabelFor(m => m.Radius, new { @style="font-size:16px"}))<br />
              
              @(Html.DropDownListFor(m => m.Radius, new SelectListItem[]{
                new SelectListItem() {Text = "5 miles", Value="5"},
                new SelectListItem() {Text = "10 miles", Value="10"},
                new SelectListItem() {Text = "25 miles", Value="25"},
                new SelectListItem() {Text = "50 miles", Value="50"},
                new SelectListItem() {Text = "90 miles", Value="90"},
              }, new{@class="form-control"}))
                   
          </div>
       }
    
        <button id="rangeFilter" type="button" class="btn btn-default submitButton" style="margin-bottom:30px;">FIND DEALERS</button>

    </div>
    

    <!-- DIV FOR GOOGLE MAP -->
    <div class="col-xs-12 col-sm-9">
        <div id="map-canvas" class="col-xs-12 col-sm-11 no-gutter" style="height:450px;">
        </div>
    </div>
    
</div>

<div class="row" style="margin-top:50px;">
    <div class="col-xs-12 col-sm-3">
        
        <div class="col-xs-12 no-gutter text-center" style="margin-bottom:30px;">
            <div style="font-size:14px; font-weight:bold;">SAVE YOUR LISTINGS</div><br />
                <div class="col-xs-6 no-gutter text-right" style="padding-right:5px;">
                    <button id="emailBtn" type="submit" class="btn btn-default wtbButton">EMAIL</button>
                </div>
                <div class="col-xs-6 no-gutter text-left" style="padding-left:5px;">
                    <button id="printBtn" type="submit" class="btn btn-default wtbButton">PRINT</button>
                </div>

        </div>
    </div>

    
            
    <div class="col-xs-12 col-sm-9">
        <div id="customerWrapper">
                  
        </div>
    </div>
           

        
    
</div>
